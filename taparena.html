<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TapArena ‚Äî Game</title>
  <meta name="description" content="60-second tap game. Combos, sounds, effects. Highest score wins." />
  <style>
    :root{
      --bg:#0b1220;
      --card:#111a2f;
      --text:#eaf0ff;
      --muted:#9fb0d0;
      --accent:#4da3ff;
      --good:#34d399;
      --bad:#ff5c7a;
      --radius:18px;
      --shadow:0 14px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 25% 10%, rgba(77,163,255,.22), transparent 60%),
        radial-gradient(700px 420px at 80% 30%, rgba(77,163,255,.12), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .wrap{max-width:520px;margin:0 auto;padding:18px}
    .top{
      display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:8px
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:44px;height:44px;border-radius:14px;background:rgba(77,163,255,.18);
      display:grid;place-items:center;font-weight:900;color:var(--accent);
      border:1px solid rgba(77,163,255,.25)
    }
    h1{margin:0;font-size:22px;line-height:1.1}
    .sub{margin:2px 0 0;color:var(--muted);font-size:12px}
    a.back{
      text-decoration:none;color:var(--text);
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      font-weight:800;
    }

    .stats{
      display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0 10px;
    }
    .stat{
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.07);
      border-radius:16px;padding:12px;
      box-shadow:var(--shadow);
      display:flex;align-items:center;justify-content:space-between;
      position:relative;
      overflow:hidden;
    }
    .stat b{font-size:18px}
    .muted{color:var(--muted);font-size:12px}

    .pillrow{display:flex;gap:10px;flex-wrap:wrap;margin:6px 0 12px}
    .pill{
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
      color:rgba(234,240,255,.92);
      font-size:12px;
    }
    .pill b{color:#fff}

    .arena{
      height:420px;
      border-radius:22px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
      margin-top:4px;
    }

    .target{
      position:absolute;
      width:104px;height:104px;border-radius:999px;
      border:1px solid rgba(77,163,255,.55);
      background:radial-gradient(circle at 35% 30%, rgba(255,255,255,.20), transparent 45%),
                 radial-gradient(circle at 50% 55%, rgba(77,163,255,.28), rgba(77,163,255,.10));
      display:grid;place-items:center;
      font-weight:1000;letter-spacing:.8px;
      user-select:none;
      touch-action:manipulation;
      cursor:pointer;
      box-shadow:0 10px 25px rgba(0,0,0,.35);
      transform:translate3d(-50%,-50%,0);
      left:50%;top:50%;
      animation:idleGlow 1.2s ease-in-out infinite;
    }
    @keyframes idleGlow{
      0%,100%{filter:drop-shadow(0 0 0 rgba(77,163,255,0));}
      50%{filter:drop-shadow(0 0 14px rgba(77,163,255,.35));}
    }

    .target.tapPop{
      animation:tapPop .14s ease-out;
    }
    @keyframes tapPop{
      0%{transform:translate3d(-50%,-50%,0) scale(1);}
      70%{transform:translate3d(-50%,-50%,0) scale(.92);}
      100%{transform:translate3d(-50%,-50%,0) scale(1.06);}
    }

    .arenaFlash{
      animation:flash .18s ease-out;
    }
    @keyframes flash{
      0%{background:rgba(255,255,255,.03)}
      100%{background:rgba(77,163,255,.06)}
    }

    .hint{
      position:absolute;inset:auto 0 14px 0;
      text-align:center;color:rgba(159,176,208,.85);font-size:12px;
      padding:0 14px;
      pointer-events:none;
    }

    .floatText{
      position:absolute;
      font-weight:900;
      font-size:14px;
      color:#ffffff;
      opacity:0.95;
      transform:translate(-50%,-50%);
      pointer-events:none;
      animation:floatUp .55s ease-out forwards;
      text-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    @keyframes floatUp{
      0%{transform:translate(-50%,-50%) scale(1);opacity:.95}
      100%{transform:translate(-50%,-90%) scale(1.15);opacity:0}
    }

    .comboBarWrap{
      height:10px;border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      margin:10px 0 12px;
    }
    .comboBar{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(77,163,255,.45), rgba(52,211,153,.45));
      transition:width .12s linear;
    }

    .btnrow{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:14px
    }
    button{
      appearance:none;border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      color:var(--text);
      border-radius:16px;
      padding:12px 14px;
      font-weight:900;
      min-width:160px;
      cursor:pointer;
    }
    button.primary{
      background:rgba(77,163,255,.22);
      border-color:rgba(77,163,255,.35);
    }
    button:disabled{opacity:.45;cursor:not-allowed}

    .toast{
      margin-top:10px;
      font-size:12px;color:rgba(159,176,208,.9)
    }

    /* Confetti particles */
    .confetti{
      position:absolute;
      width:8px;height:12px;border-radius:2px;
      opacity:.95;
      animation:confettiFall 1.1s ease-out forwards;
    }
    @keyframes confettiFall{
      0%{transform:translateY(-20px) rotate(0deg);opacity:1}
      100%{transform:translateY(520px) rotate(320deg);opacity:0}
    }

    /* Modal result */
    .modal{
      position:fixed;inset:0;
      display:none;
      place-items:center;
      background:rgba(0,0,0,.55);
      padding:18px;
      z-index:50;
    }
    .modal.show{display:grid}
    .panel{
      width:min(520px,100%);
      background:rgba(17,26,47,.96);
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.55);
      padding:16px;
    }
    .panel h2{margin:0 0 6px}
    .panel p{margin:0;color:rgba(159,176,208,.92);line-height:1.4}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .box{
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:12px;
    }
    .box .k{color:rgba(159,176,208,.9);font-size:12px}
    .box .v{font-size:20px;font-weight:1000;margin-top:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">TA</div>
        <div>
          <h1>TapArena</h1>
          <div class="sub">60 seconds ‚Ä¢ Combos ‚Ä¢ Effects</div>
        </div>
      </div>
      <a class="back" href="./index.html">Home</a>
    </div>

    <div class="stats">
      <div class="stat">
        <div>
          <div class="muted">Time</div>
          <b id="time">60s</b>
        </div>
        <div class="muted">‚è±Ô∏è</div>
      </div>
      <div class="stat">
        <div>
          <div class="muted">Score</div>
          <b id="score">0</b>
        </div>
        <div class="muted">üéØ</div>
      </div>
    </div>

    <div class="pillrow">
      <div class="pill">Combo: <b id="combo">x1</b></div>
      <div class="pill">Best: <b id="best">0</b></div>
      <div class="pill">Level: <b id="level">1</b></div>
    </div>

    <div class="comboBarWrap" aria-label="Combo timer">
      <div class="comboBar" id="comboBar"></div>
    </div>

    <div class="arena" id="arena" aria-label="Tap Arena">
      <div class="target" id="target">TAP</div>
      <div class="hint" id="hint">Tap the circle. Start game to begin. Don‚Äôt miss!</div>
    </div>

    <div class="btnrow">
      <button class="primary" id="startBtn">START GAME</button>
      <button id="copyBtn" disabled>COPY SCORE</button>
      <button id="resetBtn">RESET</button>
    </div>

    <div class="toast" id="toast"></div>
  </div>

  <!-- Result Modal -->
  <div class="modal" id="modal">
    <div class="panel">
      <h2>Round Finished üéâ</h2>
      <p id="resultText">Your score is ready.</p>
      <div class="grid2">
        <div class="box">
          <div class="k">Score</div>
          <div class="v" id="finalScore">0</div>
        </div>
        <div class="box">
          <div class="k">Best</div>
          <div class="v" id="finalBest">0</div>
        </div>
      </div>
      <div class="btnrow" style="margin-top:12px">
        <button class="primary" id="playAgainBtn">PLAY AGAIN</button>
        <button id="closeModalBtn">CLOSE</button>
      </div>
    </div>
  </div>

  <script>
    // ---------- Elements ----------
    const timeEl = document.getElementById("time");
    const scoreEl = document.getElementById("score");
    const hintEl = document.getElementById("hint");
    const toastEl = document.getElementById("toast");
    const target = document.getElementById("target");
    const arena = document.getElementById("arena");
    const startBtn = document.getElementById("startBtn");
    const resetBtn = document.getElementById("resetBtn");
    const copyBtn = document.getElementById("copyBtn");

    const comboEl = document.getElementById("combo");
    const bestEl = document.getElementById("best");
    const levelEl = document.getElementById("level");
    const comboBar = document.getElementById("comboBar");

    const modal = document.getElementById("modal");
    const resultText = document.getElementById("resultText");
    const finalScoreEl = document.getElementById("finalScore");
    const finalBestEl = document.getElementById("finalBest");
    const playAgainBtn = document.getElementById("playAgainBtn");
    const closeModalBtn = document.getElementById("closeModalBtn");

    // ---------- Game State ----------
    let score = 0;
    let timeLeft = 60;
    let running = false;

    let timerId = null;
    let spawnTimeout = null;

    // combo system
    let combo = 1;
    let comboWindowMs = 900;     // time allowed between hits
    let comboRemaining = 0;      // ms left in combo window
    let comboTickId = null;

    // difficulty
    let level = 1;
    let targetSize = 104;
    let spawnDelayMs = 420; // move target after each hit; decreases with level

    // best score local
    const BEST_KEY = "taparena_best_score";
    let best = Number(localStorage.getItem(BEST_KEY) || "0");
    bestEl.textContent = best;

    // ---------- Sound (WebAudio, no files) ----------
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    const audioCtx = AudioCtx ? new AudioCtx() : null;

    function beep(freq=440, dur=0.06, type="sine", gain=0.07){
      if(!audioCtx) return;
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type;
      o.frequency.setValueAtTime(freq, t);
      g.gain.setValueAtTime(gain, t);
      g.gain.exponentialRampToValueAtTime(0.0001, t + dur);
      o.connect(g);
      g.connect(audioCtx.destination);
      o.start(t);
      o.stop(t + dur);
    }

    function sfxTap(){
      beep(660, 0.05, "triangle", 0.08);
      beep(980, 0.04, "sine", 0.05);
    }
    function sfxMiss(){
      beep(220, 0.08, "sawtooth", 0.08);
    }
    function sfxStart(){
      beep(520, 0.06, "sine", 0.06);
      setTimeout(()=>beep(780, 0.06, "sine", 0.06), 70);
    }
    function sfxFinish(){
      beep(880, 0.06, "sine", 0.07);
      setTimeout(()=>beep(660, 0.06, "sine", 0.07), 80);
      setTimeout(()=>beep(990, 0.07, "triangle", 0.07), 160);
    }

    // ---------- Helpers ----------
    function setToast(msg){ toastEl.textContent = msg || ""; }

    function updateUI(){
      timeEl.textContent = `${timeLeft}s`;
      scoreEl.textContent = score;
      comboEl.textContent = `x${combo}`;
      levelEl.textContent = level;
      bestEl.textContent = best;
    }

    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)); }

    function setTargetSize(px){
      targetSize = px;
      target.style.width = px + "px";
      target.style.height = px + "px";
    }

    function randomPos(){
      const pad = 18;
      const rect = arena.getBoundingClientRect();
      // keep hint space at bottom
      const reservedBottom = 36;

      const maxX = rect.width - targetSize - pad;
      const maxY = rect.height - targetSize - pad - reservedBottom;

      const x = pad + Math.random() * Math.max(0, maxX - pad);
      const y = pad + Math.random() * Math.max(0, maxY - pad);

      target.style.left = (x + targetSize/2) + "px";
      target.style.top  = (y + targetSize/2) + "px";
    }

    function showFloat(text, x, y){
      const el = document.createElement("div");
      el.className = "floatText";
      el.textContent = text;
      el.style.left = x + "px";
      el.style.top = y + "px";
      arena.appendChild(el);
      setTimeout(()=>el.remove(), 700);
    }

    function arenaFlash(){
      arena.classList.remove("arenaFlash");
      // force reflow
      void arena.offsetWidth;
      arena.classList.add("arenaFlash");
      setTimeout(()=>arena.classList.remove("arenaFlash"), 220);
    }

    function confettiBurst(){
      const rect = arena.getBoundingClientRect();
      for(let i=0;i<28;i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = (Math.random()*rect.width) + "px";
        c.style.top = (-20 - Math.random()*40) + "px";
        c.style.background = `hsl(${Math.floor(Math.random()*360)} 90% 60%)`;
        c.style.animationDuration = (0.9 + Math.random()*0.8) + "s";
        arena.appendChild(c);
        setTimeout(()=>c.remove(), 1600);
      }
    }

    // ---------- Combo Timer ----------
    function startComboTick(){
      if(comboTickId) clearInterval(comboTickId);
      comboTickId = setInterval(()=>{
        if(!running) return;
        comboRemaining -= 50;
        const pct = clamp((comboRemaining / comboWindowMs) * 100, 0, 100);
        comboBar.style.width = pct + "%";
        if(comboRemaining <= 0){
          // combo expired
          combo = 1;
          comboBar.style.width = "0%";
          updateUI();
        }
      }, 50);
    }

    function resetCombo(){
      combo = 1;
      comboRemaining = 0;
      comboBar.style.width = "0%";
    }

    function hitCombo(){
      // extend combo window and raise multiplier
      comboRemaining = comboWindowMs;
      combo = clamp(combo + 1, 1, 8);
      updateUI();
    }

    // ---------- Difficulty ----------
    function updateDifficulty(){
      // increase level every 40 points (you can change)
      level = 1 + Math.floor(score / 40);

      // target gets smaller, and spawn gets faster as level rises
      const size = clamp(104 - (level-1)*6, 62, 104);
      setTargetSize(size);

      spawnDelayMs = clamp(420 - (level-1)*22, 160, 420);

      // combo window tightens slightly
      comboWindowMs = clamp(900 - (level-1)*35, 520, 900);
    }

    // ---------- Game Flow ----------
    function startGame(){
      if (running) return;

      // unlock audio on user gesture
      if(audioCtx && audioCtx.state === "suspended"){
        audioCtx.resume().catch(()=>{});
      }

      running = true;
      score = 0;
      timeLeft = 60;

      best = Number(localStorage.getItem(BEST_KEY) || "0");
      copyBtn.disabled = true;

      resetCombo();
      updateDifficulty();
      updateUI();

      hintEl.textContent = "GO! Tap fast üî• Don‚Äôt miss!";
      setToast("");
      sfxStart();
      randomPos();
      startComboTick();

      // main timer
      if(timerId) clearInterval(timerId);
      timerId = setInterval(() => {
        timeLeft -= 1;
        updateUI();

        if (timeLeft <= 0){
          endGame();
        }
      }, 1000);
    }

    function endGame(){
      running = false;
      clearInterval(timerId); timerId = null;
      clearTimeout(spawnTimeout); spawnTimeout = null;

      sfxFinish();
      confettiBurst();

      // update best score
      if(score > best){
        best = score;
        localStorage.setItem(BEST_KEY, String(best));
      }

      copyBtn.disabled = false;
      hintEl.textContent = `Finished! Score: ${score} ‚Ä¢ Best: ${best}`;
      setToast("Screenshot your score and share in Telegram ‚úÖ");

      // show modal
      finalScoreEl.textContent = score;
      finalBestEl.textContent = best;
      resultText.textContent = (score >= best) ? "New best score! üî•" : "Try again and beat your best!";
      modal.classList.add("show");
    }

    function resetGame(){
      running = false;
      clearInterval(timerId); timerId = null;
      clearTimeout(spawnTimeout); spawnTimeout = null;

      score = 0;
      timeLeft = 60;
      best = Number(localStorage.getItem(BEST_KEY) || "0");

      resetCombo();
      level = 1;
      comboWindowMs = 900;
      setTargetSize(104);
      spawnDelayMs = 420;

      copyBtn.disabled = true;
      target.textContent = "TAP";
      target.style.left = "50%";
      target.style.top = "50%";
      target.classList.remove("tapPop");
      hintEl.textContent = "Tap the circle. Start game to begin. Don‚Äôt miss!";
      setToast("");
      modal.classList.remove("show");
      updateUI();
      comboBar.style.width = "0%";
    }

    // ---------- Input ----------
    function tapTarget(ev){
      if(!running) return;

      // vibration (Android)
      if(navigator.vibrate) navigator.vibrate(12);

      // score with combo
      // base +1, plus bonus after combo >= 3
      const bonus = (combo >= 3) ? 1 : 0;
      const add = 1 + bonus;

      score += add;

      // effects
      sfxTap();
      arenaFlash();

      // pop animation
      target.classList.remove("tapPop");
      void target.offsetWidth;
      target.classList.add("tapPop");

      // float + points
      const rect = arena.getBoundingClientRect();
      const x = (ev?.clientX || rect.left + rect.width/2) - rect.left;
      const y = (ev?.clientY || rect.top + rect.height/2) - rect.top;
      showFloat(`+${add}`, x, y);

      // combo increase + extend time window
      hitCombo();

      // difficulty update
      updateDifficulty();
      updateUI();

      // move target after a short delay (feels animated)
      clearTimeout(spawnTimeout);
      spawnTimeout = setTimeout(()=>{
        if(!running) return;
        randomPos();
      }, spawnDelayMs);
